<p>※大まかにはもう勉強したので、曖昧な単語や復習でさらう</p>
DBMS=データベース管理システム。立ち位置はミドルウェア。<br>
<h1>データの取り方</h1>
選択:行単位で取り出すこと。<br>
射影:列で取り出すこと。<br>
結合:表と表をくっつけて取り出すこと。<br>
この3つを使って出来上がったら結果の表を、ビュー表という。<br>
</h2>スキーマ</h2>
データベースの構造や仕様を定義する。標準的に使用されているANSI/X3/SPARCは、三層スキーマ構造をとっている。<br>
<h2>内部スキーマ(内向きで磁気ディスクに近い)</h2>
物理的に記憶させる方法を定義。<br>
ハードウェアでの変更はこのスキーマで対応吸収することができ、ハードウェアが変わってもプログラムの修正は必要ない。<br>
<h2>概念スキーマ(データベース本体。プログラム・ハードウェア共に切り離されている。)</h2>
データの表を定義。<br>
プログラムからもハードウェアからも独立している。
<h2>外部スキーマ(ユーザーやプログラムに対してデータのどの部分が必要なのか等を定義。)</h2>
利用者からのデータの見え方をここで定義している。<br>
プログラムに変更を加えてもこの外部スキーマまでしか影響は出ない。(データそのものは変わらない。)
<h2>正規化の流れ</h2>
<h3>非正規形→第一正規形</h3>
非正規形から繰り返し部分を別表に分離。
<h3>第一正規形→第二正規形</h3>
部分関数従属の列を切り出す。
<h4>部分関数従属</h4>
複合主キーの一部分(オーダーNoと商品コードが主キーになっているところで商品コードだけに従属した商品名。など。)
<h3>第二正規形→第三正規形</h3>
主キー以外の列に関数従属している列を切り出す。
<h4>関数従属</h4>
主キーが決まると値が一意に決まる関係性
<h2>トランザクション管理と排他制御</h2>
データベースで処理がかぶってデータがおかしくなるのを防ぐために処理中にロックをかける機能。
<h3>トランザクション</h3>
連続した一つ以上の処理をひとまとめにしたもの。出荷なら、在庫数を確認する→足りてたら出荷した数だけ在庫数を更新(出荷)が一つのセットになってたりする。<br>
このトランザクションの処理中に他の人がデータをいじってしまうと最終結果がおかしくなるのでそれを防ぐためにロック(排他制御)するための単位。
<h3>排他制御</h3>
<h4>共有ロック</h4>
編集だけを制限。他のユーザーはデータを読むことはできるがいじれない。
<h4>占有ロック</h4>
読むのも制限。他のユーザーはデータの編集も読み込みもできない。
<h4>デッドロック</h4>
同じ複数のテーブルを扱うトランザクション同士がお互いにデータをロックしてしまってお互いの処理が進まなくなる現象。その時はどちらかをキャンセルするしかない。
<h3>トランザクションのACID特性</h3>
<h4>Atomicity(原子性)</h4>
トランザクションは実行時に分割されることがない。<br>
途中まで実行ということはなく、全部実行するか全く実行されないかのどちらかでないといけない。
<h4>Consistency(一貫性)</h4>
データベースの内容に矛盾がないこと。トランザクションの処理結果でデータベースの内容に矛盾を起こしてはならない。<br>
出荷と売上の更新を同時に行わない、出勤と出社人数の更新をしない。等はNG
<h4>Isolation(隔離性)</h4>
複数のトランザクションを同時に実行した場合と順番に実行した場合も処理結果に不具合をきたさないこと。<br>
排他処理を正確に行い相互の処理データに影響しないようにする。
<h4>Durability(耐久性)</h4>
正常に終了したトランザクションの更新結果について、障害が発生しても復旧できるようにすること。(ロールフォワード、ログファイルでの実行履歴等)
<h3>ストアドプロシージャ</h3>
SQL文を一つのプログラムにまとめてDBMS上に保存すること。ストアド(格納された)プロシージャ(プログラム)<br>
クライアントはプロシージャの実行指示を出せば中身のSQL文が実行される。<br>
一つずつSQL文を発行する必要がないのでネットワークの通信負荷を軽減できる。<br>
また、プロシージャはSQL文解析も済ませて即実行可能な形式なので、スピードも速い。
<h2>データベースの障害管理</h2>
データベースはその重要性から障害発生時の対策が重要。データ保護対策がいくつかある。
<h3>バックアップファイル</h3>
定期的にバックアップを取って補完する。これで過去の最後にバックアップを取ったところまでのデータは保護できる。
<h3>ジャーナル(ログファイル)</h3>
バックアップが取れていない直近の変更部分の保護のために必要な情報。<br>
更新前ジャーナルと、更新後ジャーナルを常に最新状態にし、更新履歴を管理している。
<h3>ジャーナルを使ってロールバックする部分の単語と手順</h3>
<h2>コミット</h2>
トランザクションを実行後、最後に更新内容を確定・データベースに反映させるための確定命令。<br>
このコミットがされたかされていないかで切り分けることでトランザクションの原子性(0か全部かどちらか)を維持する。<br>
トランザクションが完全に実行されてから初めてコミット(確定)されてデータベースに反映されるため、<br>
万一トランザクション実行途中でトラブルが発生してコミットまで辿り着いていなければ、そのトランザクション実行内容はデータベースには一切反映されない。
<h3>ロールバック</h3>
上記のようにコミットされずに更新失敗して実行されずに終わったトランザクションはやり直さないといけないので、<br>
データベース更新前の状態まで戻す必要がある。この戻す処理がロールバック。ロールバックするには更新前ジャーナルを使用する。
